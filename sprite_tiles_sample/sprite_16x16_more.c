#include<msx/gfx.h>
#include<stdio.h>

/* SPRITES */

u_char player_ship[] = {
    0x01,0x02,0x07,0x06,0x07,0x06,0x07,0x06,0x0F,0x1F,0x3F,0x73,0xF3,0xF3,0xF3,0xFF,
    0x80,0x40,0xE0,0x60,0xE0,0x60,0xE0,0x60,0xF0,0xF8,0xFC,0xCE,0xCF,0xCF,0xCF,0xFF };

u_char enemy_ship1[] = {
    0xFF,0x81,0x41,0x21,0x11,0x08,0x04,0xFC,0x83,0x42,0x22,0x12,0x0B,0x04,0x02,0x01,
    0xFF,0x81,0x82,0x84,0x88,0x10,0x20,0x3F,0xC1,0x42,0x44,0x48,0xD0,0x20,0x40,0x80 };

u_char enemy_ship2[] = {
    0x81,0xC3,0xFF,0xCB,0x89,0x89,0x89,0x89,0x89,0x89,0x89,0x8B,0x8A,0x8B,0x8A,0x89,
    0x81,0xC3,0xFF,0xD3,0x91,0x91,0x91,0x91,0x91,0x91,0x91,0xD1,0x51,0xD1,0x51,0x91 };

u_char star_ship[] = {
    0x10,0x20,0x40,0x81,0x82,0x84,0x8A,0xF1,0xF1,0x8A,0x84,0x82,0x81,0x40,0x20,0x10,
    0x08,0x04,0x02,0x81,0x41,0x21,0x51,0x8F,0x8F,0x51,0x21,0x41,0x81,0x02,0x04,0x08 };


/* TILING */

u_char big_planet[] = {
    0x00,0x00,0x01,0x02,0x04,0x08,0x10,0x23,
    0x20,0x40,0x40,0x40,0x87,0x9F,0x80,0x80,
    0x0F,0x70,0x80,0x07,0x00,0x00,0x0F,0xFF,
    0x70,0x00,0x00,0x00,0x0F,0xFE,0x60,0x00,

    0x80,0x80,0x87,0x80,0x40,0x40,0x40,0x20,
    0x20,0x11,0x08,0x04,0x02,0x01,0x00,0x00,
    0x07,0x7E,0xFF,0x1F,0x03,0x00,0x00,0x00,
    0xC0,0xF3,0x00,0x00,0x00,0x80,0x70,0x0F,

    0xF0,0x0E,0x01,0xC0,0x00,0x00,0xFF,0x8F,
    0x00,0x00,0x00,0x01,0xFF,0x3F,0x03,0x00,
    0x00,0x00,0x80,0x40,0x20,0x10,0x88,0x04,
    0x04,0x02,0x72,0xF2,0xE1,0x01,0x81,0x01,

    0xC0,0x00,0x00,0xFE,0xE0,0x00,0x00,0x00,
    0x3E,0xFF,0xDE,0x00,0x00,0x01,0x0E,0xF0,
    0x01,0x01,0x01,0x01,0x02,0x02,0x02,0x04,
    0x04,0x88,0x10,0x20,0x40,0x80,0x00,0x00
 };


u_char saturn_planet[] = {
    0x00,0x07,0x1F,0x38,0x60,0xC0,0x80,0x80,
    0xC0,0x60,0x38,0x1F,0x07,0x00,0x00,0x00,
    0x07,0xD8,0xA0,0x40,0x40,0x80,0x80,0x80,
    0x80,0x80,0x80,0x7F,0xBF,0x20,0x18,0x07,

    0xE0,0x1B,0x05,0x02,0x02,0x01,0x01,0x01,
    0x01,0x01,0x01,0xFE,0xFD,0x04,0x18,0xE0,
    0x00,0xE0,0xF8,0x1C,0x06,0x03,0x01,0x01,
    0x03,0x06,0x1C,0xF8,0xE0,0x00,0x00,0x00 };

u_char planet_1[] = {
    0x07,0x19,0x21,0x43,0x44,0x88,0x80,0x81,
    0x83,0x8F,0xBF,0x7E,0x78,0x30,0x18,0x07,
    0xE0,0xD8,0x84,0x02,0x02,0x11,0x21,0xE1,
    0xC1,0x03,0x07,0x0E,0x1E,0x3C,0x78,0xE0 };

u_char planet_2[] = {
    0x07,0x1F,0x3F,0x7F,0x7F,0xFF,0xFC,0xFD,
    0xFB,0xFF,0xFF,0x7F,0x78,0x30,0x18,0x07,
    0xE0,0xD8,0x84,0x82,0x8E,0x1F,0x3F,0xFF,
    0xFD,0xFB,0xE7,0xCE,0x1E,0x3C,0x78,0xE0 };



u_char stars[] = {
    0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,   // tl // 0x80
    0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,   // bl // 0x81
    0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,   // tr // 0x82 
    0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x00,   // br // 0x83

    0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x00,   // tl // 0x84
    0x40,0x00,0x00,0x00,0x00,0x00,0x08,0x00,   // bl // 0x85
    0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,   // tr // 0x86
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,   // br // 0x87

    0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,   // tl // 0x88
    0x00,0x04,0x00,0x00,0x00,0x00,0x40,0x00,   // bl // 0x89
    0x00,0x00,0x04,0x00,0x00,0x20,0x00,0x00,   // tr // 0x8A
    0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x00,   // br // 0x8B

    0x00,0x00,0x00,0x10,0x01,0x01,0x03,0x03,   // tl // 0x8C
    0x01,0x00,0x00,0x00,0x00,0x04,0x00,0x00,   // bl // 0x8D
    0x00,0x00,0x00,0x00,0xC0,0xA0,0xF0,0xF0,   // tr // 0x8E
    0x60,0xE0,0x00,0x00,0x00,0x00,0x00,0x00 }; // br // 0x8F




u_char tiles[] = {
    0x00, 0x00, 0x81, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x80, 0x00, 0x00, 0x82, 0x00, 0x00, 0x81, 0x00, 0x80, 0x00, 0x82, 0x00, 0x81, 0x00, 0x00, 0x81, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x78, 0x7A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x80, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0x80, 0x00, 0x81, 0x00,
    0x00, 0x00, 0x79, 0x7B, 0x00, 0x83, 0x00, 0x00, 0x00, 0x00, 0x83, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00,
    0x00, 0x82, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x83, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x60, 0x62, 0x68, 0x6A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00,
    0x00, 0x00, 0x80, 0x00, 0x81, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0x61, 0x63, 0x69, 0x6B, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x66, 0x6C, 0x6E, 0x00, 0x82, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00, 0x83, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x65, 0x67, 0x6D, 0x6F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0x00,
    0x81, 0x00, 0x82, 0x00, 0x7C, 0x7E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x7D, 0x7F, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00, 0x83, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x83, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x83, 0x00, 0x00, 0x81, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00,
    0x00, 0x70, 0x72, 0x74, 0x76, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x83, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81,
    0x00, 0x71, 0x73, 0x75, 0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x82, 0x00, 0x78, 0x7A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x80, 0x00, 0x83, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x79, 0x7B, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7C, 0x7E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0x7D, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x83, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00,
    0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x83, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0x00,
    0x83, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81
    };      


void print_tiles() {
    u_int vdp_addr = 6144; // until 6911 (6144 + 768)
    for (u_int tile_index = 0; tile_index < 768; tile_index++) {
        vpoke(vdp_addr + tile_index, tiles[tile_index]);
    }
}



void define_tiles(u_char init_pattern_code, u_char pattern_count, u_char* pattern) {
    uint vdp_addr = 0x0; // screen 1
    
    uint addr = vdp_addr + init_pattern_code * 8;

    for (u_char index=0; index < 8 * pattern_count; index++) {
        vpoke(addr + index, pattern[index]);
    }
}

void set_tile_colors() {
    u_char tile_colors[] = {
        0x80, 0x80, // big planet
        0x50, // saturn
        0x30, // planets
        0xF0, 0xF0  // stars
    };

    u_int index = 0;
    for (u_int addr = 0x200C; addr <= 0x2011; addr++) {
        vpoke(addr, tile_colors[index]);
        index++;
    }
}



/* Enemy ship trajectory */

int trajectory[] = {  
     1, 1, 1, 1, 1, 1, 1 ,1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2 ,2 ,2, 2, 2, 2, 3, 3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1 ,1 ,1 ,1 ,1 ,1 ,1 ,1 ,1,
    -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-3,-3,-3,-3,-3,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1};
int trajectory_len = 120;




void main() {

    


    // set graphic screen
    set_color(15, 1, 1);
    set_mode(mode_1);
    set_sprite_mode(sprite_large);

    define_tiles(0x60, 16, big_planet);
    define_tiles(0x70, 8, saturn_planet);
    define_tiles(0x78, 4, planet_1);
    define_tiles(0x7C, 4, planet_2);
    define_tiles(0x80, 16, stars);

    set_tile_colors();
    print_tiles();

    set_sprite_16(0, player_ship);
    set_sprite_16(1, enemy_ship1);
    set_sprite_16(2, enemy_ship2);
    set_sprite_16(3, star_ship);
   
    u_int x = 128;
    u_int y = 170;

    u_int index1 = 0;
    u_int index2 = 10;
    u_int index3 = 20;
    u_int index4 = 30;
    u_int index5 = 40;
    u_int index6 = 50;

    u_int x1 = 40; u_int y1 = 20;
    u_int x2 = 60;
    u_int x3 = 80;
    u_int x4 = 120;
    u_int x5 = 140;
    u_int x6 = 160; u_int y6 = 40;

    while (!get_trigger(0)) {
        int stick = get_stick(0);

        if (stick == 3) {
            x = x + 1;
        } else if (stick == 7) {
            x = x - 1;
        }

        x1 = x1 + trajectory[index1];
        x2 = x2 + trajectory[index2];
        x3 = x3 + trajectory[index3];

        x4 = x4 + trajectory[index4];
        x5 = x5 + trajectory[index5];
        x6 = x6 + trajectory[index6];

        y6 = y6 + trajectory[index3];

        put_sprite_16(1, x1, 20, 1, 10);
        put_sprite_16(2, x2, 40, 2, 11);
        put_sprite_16(3, x3, 60, 3, 12);

        put_sprite_16(4, x4, 80, 1, 13);
        put_sprite_16(5, x5, 100, 2, 14);
        put_sprite_16(6, x6, 120, 3, 2);

        index1++; if (index1 > trajectory_len) { index1 = 0; }
        index2++; if (index2 > trajectory_len) { index2 = 0; }
        index3++; if (index3 > trajectory_len) { index3= 0; }
        index4++; if (index4 > trajectory_len) { index4 = 0; }
        index5++; if (index5 > trajectory_len) { index5 = 0; }
        index6++; if (index6 > trajectory_len) { index6 = 0; }

        put_sprite_16(0, x, y, 0, 15);
    }
 }
